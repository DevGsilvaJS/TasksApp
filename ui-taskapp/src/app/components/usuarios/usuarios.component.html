<div class="page-container">
  <div class="page-header">
    <h2>Usuários</h2>
    <button class="btn-primary" (click)="abrirFormulario()" [disabled]="loading">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14"></path>
      </svg>
      Novo Usuário
    </button>
  </div>

  @if (error) {
    <div class="alert alert-error">
      {{ error }}
    </div>
  }

  @if (showForm) {
    <div class="modal-overlay" (click)="fecharFormulario()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Cadastrar Novo Usuário</h3>
          <button class="btn-close" (click)="fecharFormulario()">×</button>
        </div>
        <form (ngSubmit)="cadastrarUsuario()" class="form">
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" [(ngModel)]="novoUsuario.nome" name="nome" required>
          </div>
          <div class="form-group">
            <label>Sobrenome</label>
            <input type="text" [(ngModel)]="novoUsuario.sobrenome" name="sobrenome">
          </div>
          <div class="form-group">
            <label>CPF/CNPJ</label>
            <input type="text" [(ngModel)]="novoUsuario.docFederal" name="docFederal">
          </div>
          <div class="form-group">
            <label>RG/IE</label>
            <input type="text" [(ngModel)]="novoUsuario.docEstadual" name="docEstadual">
          </div>
          <div class="form-group">
            <label>Login *</label>
            <input type="text" [(ngModel)]="novoUsuario.login" name="login" required>
          </div>
          <div class="form-group">
            <label>Senha *</label>
            <input type="password" [(ngModel)]="novoUsuario.senha" name="senha" required>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="fecharFormulario()">Cancelar</button>
            <button type="submit" class="btn-primary" [disabled]="loading">
              {{ loading ? 'Salvando...' : 'Salvar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  @if (loading && usuarios.length === 0) {
    <div class="loading">Carregando...</div>
  } @else if (usuarios.length === 0) {
    <div class="empty-state">
      <p>Nenhum usuário cadastrado</p>
    </div>
  } @else {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Sobrenome</th>
            <th>Login</th>
            <th>CPF/CNPJ</th>
          </tr>
        </thead>
        <tbody>
          @for (usuario of usuarios; track usuario.usuarioId) {
            <tr>
              <td>{{ usuario.usuarioId }}</td>
              <td>{{ usuario.nome }}</td>
              <td>{{ usuario.sobrenome || '-' }}</td>
              <td>{{ usuario.login }}</td>
              <td>{{ usuario.docFederal || '-' }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
